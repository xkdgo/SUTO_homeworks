## Скрипт для обработки логов Nginx

### Основная функциональность

Скрипт обрабатывает при запуске последний (со самой свежей датой в имени, не по mtime файла!) лог в
LOG_DIR , в результате работы генерируется html отчет.

Скрипт делает проверку на повторный запуск по той же дате.
При наличии файла с последней датой работа не переделывается.
Готовые отчеты лежат в REPORT_DIR.

В отчет попадает REPORT_SIZE URL'ов с наибольшим суммарным временем обработки
( time_sum ).

### Запуск
Скрипт запускается командой в терминале из папки, в которой находится:

`python3 log_analyzer.py`

### Настройки по умолчанию
```python
{
    "LOG_DIR": "./log", # папка с логами nginx
    "REPORT_DIR": "./reports", # папка для сохранения отчетов
    "REPORT_SIZE": 1000, # размер отчета
    "REPORT_TEMPLATE": "./templates/report.html", # место шаблона отчета
    # "REPORT_LOG": "./log_analyzer.log", # при наличии логи пишутся в файл, иначе в консоль
    "PARSE_ERROR_PERC_MAX": 0.1, # доля превышения ошибок чтения 10%
    "DEBUG": False # включение/отключение уровня логгирования DEBUG
}
```
### Опции при запуске

При запуске скрипта ему можно передать путь к настройкам в виде: 

`python3 log_analyzer.py --config /folder/config.json`

**Содержание файла**

```python
{
    "REPORT_SIZE": 100, # — размер отчета 
    "REPORT_DIR": "./reports", # — директория для отчетов
    "LOG_DIR": "./log", # — директория с логами
    "REPORT_LOG": "./monitoring/log_analyzer.log" # — файл для сохранения логов
}
```

Если переменная 

`REPORT_LOG`

отсутствует в файле конфигурации, то логи выводятся в терминал.

### Результат

Результат сохраняется в виде .html файла папку, указанную в настройках. По умолчанию это

`./reports`

Если отчет за сегодня уже существует в папке, скрипт не будет его пересчитывать.

### Тестирование

Скрипт сопровождается тест-пакетом. Для запуска необходимо ввести команду: 

`python3 test_log_analyzer.py`

или

`python3 -m unittest test_log_analyzer`
